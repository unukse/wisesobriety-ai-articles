<!DOCTYPE html>
<html>
  <head>
    <title>Reset Password</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  </head>
  <body>
    <h1>Set a new password</h1>
    <input type="password" id="new-password" placeholder="New password" />
    <button onclick="resetPassword()">Reset Password</button>

    <script>
      // Supabase credentials
      const supabaseUrl = 'https://nzmtiwjdtcgzifxygxsa.supabase.co';
      const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56bXRpd2pkdGNnemlmeHlneHNhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1NTUyMzEsImV4cCI6MjA2NzEzMTIzMX0.vJxUHnLPvjBjM7hh3xk4cQlGj-hKrDze12eNk10BzSg';
      
      const supabase = supabase.createClient(supabaseUrl, supabaseAnonKey);

      async function resetPassword() {
        const hash = window.location.hash;
        const params = new URLSearchParams(hash.replace('#', '?'));
        const access_token = params.get('access_token');

        if (!access_token) {
          alert("Missing access token");
          return;
        }

        const { error: sessionError } = await supabase.auth.setSession({
          access_token,
          refresh_token: '' // not needed here
        });

        const newPassword = document.getElementById('new-password').value;

        const { error } = await supabase.auth.updateUser({
          password: newPassword
        });

        if (error || sessionError) {
          alert("Failed to reset password.");
        } else {
          window.location.href = 'password-updated.html';
        }
      }
    </script>
  </body>
</html> 